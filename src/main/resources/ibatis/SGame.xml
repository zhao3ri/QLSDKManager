<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SGame">

    <!--<cache type="org.mybatis.caches.ehcache.EhcacheCache"/>-->

    <typeAlias alias="sGame" type="com.item.domain.SGame"/>
    <typeAlias alias="mb" type="core.module.orm.MapBean"/>

    <select id="SGame.summary" resultClass="sGame" parameterClass="mb">
        SELECT
			clientType,
			totalRoleUser,
			totalRegUser,
			devices,
			activeUsers,
			payAmount,
			payTimes,
			payUsers
		FROM s_game_history sg 
		WHERE statDate=#statDate#
		AND  appId=#appId# AND clientType=#clientType#
    </select>

    <select id="SGame.stat" resultClass="sGame" parameterClass="mb">
        SELECT
        sg.appId as appId,
        sg.clientType as clientType,
        SUM(sg.totalRoleUser) as totalRoleUser,
        SUM(sg.totalRegUser) as totalRegUser,
        SUM(sg.devices) as devices,
        SUM(sg.activeUsers) as activeUsers,
        SUM(sg.payAmount) as payAmount,
        SUM(sg.payTimes) as payTimes,
        SUM(sg.payUsers) as payUsers,
        SUM(sd.newUserPays) AS totalNewPayUser
        FROM
        s_game_history sg JOIN s_game_daily sd ON (sg.appId=sd.appId AND sg.clientType=sd.clientType)
        <dynamic prepend="where">
            <isNotNull prepend="and" property="clientType">
                sg.clientType=#clientType#
            </isNotNull>
            <isNotNull prepend="and" property="appId">
                sg.appId=#appId#
            </isNotNull>
            <isNotEmpty prepend="and" property="statDate">
                sd.statDate=#statDate#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="like">
                sd.statDate LIKE '$like$%'
            </isNotEmpty>
        </dynamic>
        <isNotEmpty property="groupby">
            GROUP BY $groupby$
        </isNotEmpty>
    </select>
</sqlMap>