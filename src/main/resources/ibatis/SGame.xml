<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SGame">

    <!--<cache type="org.mybatis.caches.ehcache.EhcacheCache"/>-->

    <typeAlias alias="sGame" type="com.item.domain.SGame"/>
    <typeAlias alias="mb" type="core.module.orm.MapBean"/>

    <sql id="SGame.Where">
        <dynamic prepend="where">
            <isNotNull prepend="and" property="clientType">
                sg.clientType=#clientType#
            </isNotNull>
            <isNotNull prepend="and" property="appId">
                sg.appId=#appId#
            </isNotNull>
            <isNotEmpty prepend="and" property="statDate">
                sg.statDate=#statDate#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="like">
                sg.statDate LIKE '$like$%'
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="appIds">
                sg.appId IN
                <iterate property="appIds" open="(" close=")" conjunction=",">
                    #appIds[]#
                </iterate>
            </isNotEmpty>
        </dynamic>
    </sql>

    <select id="SGame.summary" resultClass="sGame" parameterClass="mb">
        SELECT
        sg.appId as appId,
        sg.clientType as clientType,
        SUM(sg.totalRoleUser) as totalRoleUser,
        SUM(sg.totalRegUser) as totalRegUser,
        SUM(sg.devices) as devices,
        SUM(sg.activeUsers) as activeUsers,
        SUM(sg.payAmount) as payAmount,
        SUM(sg.payTimes) as payTimes,
        SUM(sg.payUsers) as payUsers,
        SUM(sd.newUserPays) AS totalNewPayUser
        FROM
        s_game_history sg JOIN s_game_daily sd ON (sg.appId=sd.appId AND sg.clientType=sd.clientType AND
        sg.statDate=sd.statDate)
        <include refid="SGame.Where"/>
        <isNotEmpty property="groupby">
            GROUP BY $groupby$
        </isNotEmpty>
    </select>

    <select id="SGame.stat" resultClass="sGame" parameterClass="mb">
        SELECT
        sg.appId as appId,
        sg.clientType as clientType,
        sg.statDate as statDate,
        sg.totalRoleUser as totalRoleUser,
        sg.totalRegUser as totalRegUser,
        sg.devices as devices,
        sg.activeUsers as activeUsers,
        sg.payAmount as payAmount,
        sg.payTimes as payTimes,
        sg.payUsers as payUsers,
        sd.newUserPays AS totalNewPayUser
        FROM
        s_game_history sg JOIN s_game_daily sd ON (sg.appId=sd.appId AND sg.clientType=sd.clientType AND
        sg.statDate=sd.statDate)
        <include refid="SGame.Where"/>
        <isNotEmpty property="groupby">
            GROUP BY $groupby$
        </isNotEmpty>
    </select>
</sqlMap>