<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BChannelGameZone">

    <!--<cache type="org.mybatis.caches.ehcache.EhcacheCache"/>-->
    
    <typeAlias alias="bChannelGameZone" type="com.item.domain.BChannelGameZone" />
    <typeAlias alias="mb" type="core.module.orm.MapBean" />

    <sql id="BChannelGameZone.Where">
    	<dynamic prepend="where">
    		<isNotNull prepend="and" property="id">
    			a.`id`=#id#
    		</isNotNull>
    		<isNotNull prepend="and" property="channelId">
    			a.`channelId`=#channelId#
    		</isNotNull>
    		<isNotNull prepend="and" property="gameId">
    			a.`gameId`=#gameId#
    		</isNotNull>
    		<isNotNull prepend="and" property="zoneId">
    			a.`zoneId`=#zoneId#
    		</isNotNull>
    		<isNotNull prepend="and" property="channelIds">
    			a.channelId IN
	    		<iterate property="channelIds" open="(" close=")" conjunction=",">
			      #channelIds[]#
			    </iterate>
    		</isNotNull>
    		<isNotNull prepend="and" property="zoneIds">
    			a.zoneId IN
	    		<iterate property="zoneIds" open="(" close=")" conjunction=",">
			      #zoneIds[]#
			    </iterate>
    		</isNotNull>
    	</dynamic>
    </sql>

    <select id="BChannelGameZone.page" parameterClass="mb" resultClass="bChannelGameZone">
        SELECT
	  		a.`id`,
			a.channelId,
			a.gameId,
			a.`zoneId`,
			b.channelName AS channelName,
			c.zoneName AS zoneName,
			d.gameName AS gameName
		FROM b_channel_game_zone AS a
		JOIN b_game AS d ON d.id=a.gameId
		JOIN b_channel AS b ON a.channelId = b.id
		JOIN b_game_zone AS c ON a.gameId = c.gameId AND a.zoneId = c.zoneId
        <include refid="BChannelGameZone.Where"/>
        <isNotNull property="orderby">
        	ORDER BY $orderby$
        </isNotNull>
        LIMIT #firstResult#, #pageSize#
    </select>

    <select id="BChannelGameZone.count" resultClass="Long" parameterClass="mb">
        SELECT COUNT(1)
		FROM b_channel_game_zone AS a
		JOIN b_game AS d ON d.id=a.gameId
		JOIN b_channel AS b ON a.channelId = b.id
		JOIN b_game_zone AS c ON a.gameId = c.gameId AND a.zoneId = c.zoneId
        <include refid="BChannelGameZone.Where"/>
    </select>

    <select id="BChannelGameZone.list" resultClass="bChannelGameZone" parameterClass="mb">
        SELECT
	  		a.`id`,
			a.channelId,
			a.gameId,
			a.`zoneId`,
			b.channelName,
			c.zoneName
		FROM b_channel_game_zone AS a
		JOIN b_channel AS b ON a.channelId = b.id
		JOIN b_game_zone AS c ON a.gameId = c.gameId AND a.zoneId = c.zoneId
        <include refid="BChannelGameZone.Where"/>
        <isNotNull property="orderby">
             ORDER BY $orderby$
        </isNotNull>
        <isNotNull property="pageSize">
       	     LIMIT 0, #pageSize#
        </isNotNull>
    </select>
    
    <select id="BChannelGameZone.getChannelZones" resultClass="bChannelGameZone" parameterClass="mb">
        SELECT 
        	a.zoneId,
        	b.zoneName 
        FROM b_channel_game_zone AS a
        JOIN b_game_zone AS b ON a.gameId = b.gameId AND a.zoneId = b.zoneId
        <include refid="BChannelGameZone.Where"/>
        GROUP BY a.zoneId;
    </select>
    
    <select id="BChannelGameZone.getZoneChannels" resultClass="bChannelGameZone" parameterClass="mb">
        SELECT 
        	a.channelId,
        	b.channelName
        FROM b_channel_game_zone AS a
        JOIN b_channel AS b ON a.channelId = b.id
        <include refid="BChannelGameZone.Where"/>
        GROUP BY a.channelId;
    </select>

    <select id="BChannelGameZone.get" resultClass="bChannelGameZone" parameterClass="Long">
        SELECT
	   		`id`,
			channelId,
			gameId,
			`zoneId`
		FROM b_channel_game_zone
		WHERE
	  		`id`=#id# 
    </select>

    <insert id="BChannelGameZone.save" parameterClass="bChannelGameZone">
        INSERT INTO b_channel_game_zone(
        	channelId,
			gameId,
			`zoneId`
        )VALUES(
        	#channelId#,
			#gameId#,
			#zoneId#
        )
        <selectKey resultClass="Long" keyProperty="id">
	       select @@IDENTITY as `id`
        </selectKey> 
    </insert>

    <update id="BChannelGameZone.update" parameterClass="bChannelGameZone">
    	UPDATE b_channel_game_zone
	    	<dynamic prepend="set">
	    		<isNotNull prepend="," property="channelId">
					`channelId`=#channelId#
				</isNotNull>
	    		<isNotNull prepend="," property="gameId">
					`gameId`=#gameId#
				</isNotNull>
	    		<isNotNull prepend="," property="zoneId">
					`zoneId`=#zoneId#
				</isNotNull>
	    	</dynamic>
    	WHERE
    		`id`=#id# 
    </update>

    <delete id="BChannelGameZone.delete" parameterClass="Long">
		DELETE FROM b_channel_game_zone
		WHERE
			`id`=#id# 
    </delete>
    
    <delete id="BChannelGameZone.deleteAll" parameterClass="mb">
		DELETE FROM b_channel_game_zone
		WHERE
			gameId=#gameId# AND channelId=#channelId#
    </delete>
    
    	<!-- 获取指定id对应的数据  -->
	<select id="BChannelGameZone.getChannelGamezoneById" parameterClass="Long" resultClass="Gamezone">
		SELECT * FROM b_game_zone WHERE id=#id# AND channelId=#channelId#"
	</select>
    
</sqlMap>